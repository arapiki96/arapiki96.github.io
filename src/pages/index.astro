---
import { Image } from "astro:assets";
import BaseLayout from "../layouts/baselayout.astro";
import { getThomasManchStories } from "../lib/businessdeskFeed";
import { formatDate, formatDateTime } from "../lib/dateUtils";
import thomasPhoto from "../assets/thomas.jpg";

let stories = [];
let errorMessage = null;
try {
  stories = await getThomasManchStories(10);
} catch (e) {
  console.error('BusinessDesk feed error:', e);
  errorMessage = e.message || 'Unable to load recent stories at this time';
}

const updatedAt = formatDateTime(new Date());
---

<BaseLayout
  title="Thomas Manch"
  description="Senior reporter covering infrastructure, transport, and housing in New Zealand."
>
  <section class="intro">
    <h1 class="intro-title">Thomas Manch</h1>
    <div class="intro-photo">
      <Image src={thomasPhoto} alt="Thomas Manch" width={180} height={180} />
    </div>
    <div class="intro-text">
      <p>I'm a senior reporter covering infrastructure, transport, and housing at <a href="https://businessdesk.co.nz/journalist/thomas-manch" rel="me noopener noreferrer" target="_blank">BusinessDesk</a>.</p>
      <p>
        I've worked as a journalist for a decade. Previously I covered politics,
        with a focus on foreign policy, trade, and defence, for <i>The Post</i> and Stuff.co.nz. I have also been a crime and general news reporter.
      </p>
      <p>I live in Wellington, New Zealand.</p>
      <p>
        On this website I intend to display my work and provide the best means to contact me.
      </p>
      <p>
        You can also find me on
        <a href="https://www.instagram.com/thomas_manch_/" rel="me noopener noreferrer" target="_blank">Instagram</a>,
        <a href="https://x.com/thomas_manch_" rel="me noopener noreferrer" target="_blank">X (Twitter)</a>,
        and
        <a href="https://www.linkedin.com/in/thomas-manch-58a612157/" rel="me noopener noreferrer" target="_blank">LinkedIn</a>.
      </p>
    </div>
  </section>
  <section>
    <h2>Recent reporting on BusinessDesk</h2>
    <p class="muted">Last updated: {updatedAt} (NZ time)</p>

    {errorMessage ? (
      <p class="muted">Stories temporarily unavailable. Please visit <a href="https://businessdesk.co.nz/journalist/thomas-manch" target="_blank" rel="noopener noreferrer">BusinessDesk</a> directly.</p>
    ) : stories.length ? (
      <ol>
        {stories.map((s) => (
          <li>
            <a href={s.link} target="_blank" rel="noopener noreferrer">
              {s.title}
            </a>
            <div class="meta">{formatDate(s.pubDate)}</div>
          </li>
        ))}
      </ol>
    ) : (
      <p class="muted">No recent items found.</p>
    )}
  </section>

</BaseLayout>
